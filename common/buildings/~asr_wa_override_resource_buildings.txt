# Food
building_massive_growth_1 = {
  icon = "massive_growth_1"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_1
  category = resource
  can_build = yes
  can_demolish = yes

  building_sets = {
    farming
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b1_minerals
      biomass = @b1_biomass
    }
    upkeep = {
      minerals = @b1_upkeep
    }
  }
  upgrades = {
    building_massive_growth_2
  }

  inline_script = {
    script = jobs/farmers_add
    AMOUNT = @building_static_jobs_low
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_massive_growth_2 = {
  icon = "massive_growth_2"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_2
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    farming
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }
  allow = {
    has_upgraded_capital = yes
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b2_minerals
      biomass = @b2_biomass
    }
    upkeep = {
      minerals = @b2_upkeep
    }
  }
  upgrades = {
    building_massive_growth_3
  }

  inline_script = {
    script = jobs/farmers_add
    AMOUNT = @building_static_jobs
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_massive_growth_3 = { # substitute for 'building_food_processing_facility'
  icon = "massive_growth_3"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_3
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    farming
  }

  planet_limit = 1
  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  allow = {
    has_major_upgraded_capital = yes
  }
  destroy_trigger = {
    exists = owner
    OR = {
      owner = {
        is_ai = yes
        country_uses_food = no
        is_wilderness_empire = no
      }
      is_planet_class = pc_machine
      has_modifier = resort_colony
      AND = {
        owner = { is_ai = yes }
        has_any_farming_district_or_building = no
      }
    }
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b3_minerals
      biomass = @b3_biomass
      exotic_gases = @b2_rare_cost
    }
    upkeep = {
      minerals = @b3_upkeep
      exotic_gases = @b2_rare_upkeep
    }
  }
  prerequisites = {
    "tech_food_processing_1"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  upgrades = {
    building_massive_growth_4
  }

  planet_modifier = {
    planet_farmers_food_produces_add = 2
  }

  inline_script = {
    script = jobs/farmers_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_massive_growth_4 = { # substitute for 'building_food_processing_center'
  icon = "massive_growth_4"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_4
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    farming
  }

  planet_limit = 1
  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  allow = {
    has_fully_upgraded_capital = yes
  }
  destroy_trigger = {
    OR = {
      AND = {
        exists = owner
        OR = {
          owner = {
            is_ai = yes
            country_uses_food = no
            is_wilderness_empire = no
          }
          AND = {
            owner = { is_ai = yes }
            has_any_farming_district_or_building = no
          }
        }
      }
      is_planet_class = pc_machine
      has_modifier = resort_colony
    }
  }
  prerequisites = {
    "tech_food_processing_2"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b4_minerals
      exotic_gases = @b3_rare_cost
      biomass = @b4_biomass
    }
    upkeep = {
      minerals = @b4_upkeep
      exotic_gases = @b3_rare_upkeep
    }
  }

  planet_modifier = {
    planet_farmers_food_produces_add = 2
    pop_agri_drone_bonus_workforce_mult = 0.15
  }

  inline_script = {
    script = jobs/farmers_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

# Energy
building_bioelectric_stimulator_1 = {
  icon = "bio_electric_stimulator_1"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_1
  category = resource
  can_build = yes
  can_demolish = yes

  building_sets = {
    generator
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b1_minerals
      biomass = @b1_biomass
    }
    upkeep = {
      minerals = @b1_upkeep
    }
  }
  upgrades = {
    building_bioelectric_stimulator_2
  }

  inline_script = {
    script = jobs/technicians_add
    AMOUNT = @building_static_jobs_low
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_bioelectric_stimulator_2 = {
  icon = "bio_electric_stimulator_2"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_2
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    generator
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }
  allow = {
    has_upgraded_capital = yes
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b2_minerals
      biomass = @b2_biomass
    }
    upkeep = {
      minerals = @b2_upkeep
    }
  }

  upgrades = {
    building_bioelectric_stimulator_3
  }

  inline_script = {
    script = jobs/technicians_add
    AMOUNT = @building_static_jobs
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_bioelectric_stimulator_3 = { # substitute for 'building_energy_grid'
  icon = "bio_electric_stimulator_3"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_3
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    generator
  }

  planet_limit = 1
  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  allow = {
    has_major_upgraded_capital = yes
  }
  destroy_trigger = {
    exists = owner
    OR = {
      has_modifier = resort_colony
      AND = {
        owner = { is_ai = yes }
        has_any_generator_district_or_building = no
      }
      owner = { is_wilderness_empire = no }
    }
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b3_minerals
      rare_crystals = @b2_rare_cost
      biomass = @b3_biomass
    }
    upkeep = {
      minerals = @b3_upkeep
      rare_crystals = @b2_rare_upkeep
    }
  }

  prerequisites = {
    tech_power_hub_1
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  upgrades = {
    building_bioelectric_stimulator_4
  }

  planet_modifier = {
    planet_technician_energy_produces_add = 2
  }

  inline_script = {
    script = jobs/technicians_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_bioelectric_stimulator_4 = { # substitute for 'building_energy_nexus'
  icon = "bio_electric_stimulator_4"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_4
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    generator
  }

  planet_limit = 1
  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  destroy_trigger = {
    exists = owner
    OR = {
      has_modifier = resort_colony
      AND = {
        owner = { is_ai = yes }
        has_any_generator_district_or_building = no
      }
      owner = { is_wilderness_empire = no }
    }
  }
  allow = {
    has_fully_upgraded_capital = yes
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b4_minerals
      rare_crystals = @b3_rare_cost
      biomass = @b4_biomass
    }
    upkeep = {
      minerals = @b4_upkeep
      rare_crystals = @b3_rare_upkeep
    }
  }

  prerequisites = {
    tech_power_hub_2
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  planet_modifier = {
    planet_technician_energy_produces_add = 2
    pop_technician_drone_bonus_workforce_mult = 0.15
  }

  inline_script = {
    script = jobs/technicians_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes

}

# Mining
building_churning_tunnels_1 = {
  icon = "churning_tunnels_1"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_1
  category = resource
  can_build = yes
  can_demolish = yes

  building_sets = {
    mining
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b1_minerals
      biomass = @b1_biomass
    }
    upkeep = {
      minerals = @b1_upkeep
    }
  }

  inline_script = {
    script = jobs/miners_add
    AMOUNT = @building_static_jobs_low
  }

  upgrades = {
    building_churning_tunnels_2
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_churning_tunnels_2 = {
  icon = "churning_tunnels_2"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_2
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    mining
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }
  allow = {
    has_upgraded_capital = yes
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b2_minerals
      biomass = @b2_biomass
    }
    upkeep = {
      minerals = @b2_upkeep
    }
  }

  upgrades = {
    building_churning_tunnels_3
  }

  inline_script = {
    script = jobs/miners_add
    AMOUNT = @building_static_jobs
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_churning_tunnels_3 = { # substitute for 'building_mineral_purification_plant'
  icon = "churning_tunnels_3"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_3
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    mining
  }

  planet_limit = 1
  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  destroy_trigger = {
    exists = owner
    OR = {
      has_modifier = resort_colony
      AND = {
        owner = { is_ai = yes }
        has_any_mining_district_or_building = no
      }
      owner = { is_wilderness_empire = no }
    }
  }
  allow = {
    has_major_upgraded_capital = yes
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b3_minerals
      volatile_motes = @b2_rare_cost
      biomass = @b3_biomass
    }
    upkeep = {
      minerals = @b3_upkeep
      volatile_motes = @b2_rare_upkeep
    }
  }

  prerequisites = {
    "tech_mineral_purification_1"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  upgrades = {
    building_churning_tunnels_4
  }

  planet_modifier = {
    planet_miners_minerals_produces_add = 2
  }

  inline_script = {
    script = jobs/miners_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_churning_tunnels_4 = { # substitute for 'building_mineral_purification_hub'
  icon = "churning_tunnels_4"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_4
  category = resource
  can_build = no
  can_demolish = yes

  building_sets = {
    mining
  }

  planet_limit = 1
  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  destroy_trigger = {
    exists = owner
    OR = {
      has_modifier = resort_colony
      AND = {
        owner = { is_ai = yes }
        has_any_mining_district_or_building = no
      }
      owner = { is_wilderness_empire = no }
    }
  }
  allow = {
    has_fully_upgraded_capital = yes
  }
  resources = {
    category = planet_buildings
    cost = {
      minerals = @b4_minerals
      volatile_motes = @b3_rare_cost
      biomass = @b4_biomass
    }
    upkeep = {
      minerals = @b4_upkeep
      volatile_motes = @b3_rare_upkeep
    }
  }

  planet_modifier = {
    planet_miners_minerals_produces_add = 2
    pop_mining_drone_bonus_workforce_mult = 0.15
  }

  inline_script = {
    script = jobs/miners_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  prerequisites = {
    "tech_mineral_purification_2"
  }

  ai_estimate_without_unemployment = yes

  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }
}

##########
# Storage
##########
building_subterranean_cache = { # substitute for 'building_resource_silo'
  icon = "subterranean_cache"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_1
  category = resource
  can_build = yes
  can_demolish = yes

  building_sets = {
    government
    mining
    farming
    generator
    urban
  }

  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  allow = {
    exists = owner
    hidden_trigger = {
      OR = {
        owner = { is_ai = no }
        AND = {
          NOT = { has_building = building_resource_silo }
          OR = {
            owner = {
              is_machine_empire = yes
              has_active_tradition = tr_domination_modular_depot
            }
            is_active_resolution = "resolution_greatergood_balance_in_the_middle"
            is_active_resolution = "resolution_greatergood_universal_prosperity_mandate"
            owner = {
              has_ascension_perk = ap_arcology_project
              NOT = { has_technology = tech_mega_engineering }
            }
          }
        }
      }
    }
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b1_minerals
      biomass = @b1_biomass
    }
    upkeep = {
      minerals = @b1_upkeep
    }
  }
  country_modifier = {
    country_resource_max_add = 5000
  }
  triggered_country_modifier = {
    potential = {
      exists = owner
      owner = { has_technology = tech_construction_templates }
    }
    country_resource_max_add = 5000
  }
  triggered_country_modifier = {
    potential = {
      exists = owner
      owner = {
        is_wilderness_empire = yes
        has_technology = tech_archaeostudies
      }
    }
    country_resource_max_minor_artifacts_add = 100
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  prerequisites = {
    "tech_basic_industry"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  ai_estimate_without_unemployment = yes
}

# (Cosmic Storms) Storm Relief Center | substitute for 'building_storm_resistant_production'
# NOTE: no upgrade for this version
building_wilderness_storm_relief = {
  base_buildtime = @b1_time
  planet_limit = 1
  category = resource

  building_sets = {
    government
  }

  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
    OR = {
      owner = { is_ai = no }
      solar_system = { system_has_storm_repelling_tech = no }
    }
  }
  destroy_trigger = {
    exists = owner
    owner = { is_wilderness_empire = no }
    influence_building_destruction_trigger = yes
  }

  prerequisites = {
    "tech_industrial_storm_protection"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  resources = {
    category = planet_buildings_storm_tech
    # Basic Building costs (inherited from 'building_storm_resistant_production')
    cost = {
      minerals = @b2_minerals
      biomass = @b2_biomass
    }
    upkeep = {
      energy = @b2_upkeep
    }
    upkeep = {
      trigger = {
        has_modifier = storm_hunkered_down_modifier
      }
      energy = @b1_upkeep
    }
    # NOTE: 'maintenance_drone' Jobs do not charge Upkeep; nor does their Wilderness substitute
  }

  # Modifiers inherited from 'building_storm_resistant_production': @b1_jobs x 'maintenance_drone' Job Output
  # NOTE: Ringworld modifiers are not applicable to Wilderness
  triggered_planet_modifier = {
    planet_amenities_no_happiness_add = 800
    mult = value:scripted_modifier_mult|MODIFIER|pop_job_amenities_mult|
  }
  triggered_planet_modifier = {
    potential = {
      exists = planet.orbital_defence
      planet.orbital_defence = {
        exists = starbase
        starbase = { has_starbase_building = ring_maintenance_hub }
      }
    }
    planet_amenities_no_happiness_add = 100
    mult = value:scripted_modifier_mult|MODIFIER|pop_job_amenities_mult|
  }

  # Modifiers adjusted by GalCom Resolutions
  triggered_planet_modifier = {
    potential = {
      exists = owner
      owner = { is_galactic_community_member = yes }
    }
    modifier = {
      planet_miners_produces_mult = 1
      planet_farmers_produces_mult = 1
      planet_technician_produces_mult = 1
    }
    mult = value:storm_building_production_multiplier
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  custom_tooltip = "building_wilderness_storm_relief_tt"

  custom_storm_ai_weight = {
    weight = 0
    modifier = {
      add = 30
      AND = {
        exists = owner
        owner = { num_unique_cosmic_storms_encountered >= 2 }
      }
    }
  }
}
