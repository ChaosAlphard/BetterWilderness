#####################
# Military & Defense
#####################

building_planetary_carapace = { # substitute for 'building_stronghold'
  icon = "planetary_carapace_1"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_2
  category = army
  can_build = yes
  can_demolish = yes

  building_sets = {
    government
    fortress
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }
  prerequisites = {
    "tech_planetary_defenses"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b2_minerals
      biomass = @b2_biomass
    }
    upkeep = {
      minerals = @b2_upkeep
    }
  }

  inline_script = {
    script = jobs/soldiers_add
    AMOUNT = @building_static_jobs
  }

  upgrades = {
    building_planetary_carapace_2
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

building_planetary_carapace_2 = { # substitute for 'building_fortress'
  icon = "planetary_carapace_2"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_3
  category = army
  can_build = no
  can_demolish = yes
  planetary_ftl_inhibitor = yes

  building_sets = {
    government
    fortress
  }

  inline_script = {
    script = buildings/wilderness_buildings_potential_destroy
  }
  allow = {
    has_upgraded_capital = yes
  }
  prerequisites = {
    "tech_global_defense_grid"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b3_minerals
      biomass = @b3_biomass
      volatile_motes = @b2_rare_cost
    }
    upkeep = {
      minerals = @b3_upkeep
      volatile_motes = @b2_rare_upkeep
    }
  }

  inline_script = {
    script = jobs/soldiers_add
    AMOUNT = @building_static_jobs_high
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  ai_estimate_without_unemployment = yes
}

# Planetary Shield Generator
building_ozone_thickener = {
  icon = "ozone_thickener"
  ruined_icon = "wilderness_building_ruined"
  base_buildtime = @buildtime_5
  category = army
  can_build = yes
  can_demolish = yes
  planet_limit = 1

  building_sets = {
    government
    fortress
  }

  potential = {
    exists = owner
    owner = { is_wilderness_empire = yes }
  }
  allow = {
    has_upgraded_capital = yes
    if = {
      limit = { exists = orbital_defence }
      orbital_defence = {
        exists = starbase
        starbase = {
          NOR = {
            has_starbase_building = ring_orbital_shield_generator
            is_starbase_building_building = ring_orbital_shield_generator
          }
        }
      }
    }
  }
  prerequisites = {
    "tech_planetary_shield_generator"
  }
  show_tech_unlock_if = {
    is_wilderness_empire = yes
  }

  planet_modifier = {
    planet_orbital_bombardment_damage = -0.5
  }
  triggered_planet_modifier = {
    potential = { has_cosmic_storms_dlc = yes }
    planet_storm_devastation_mult = -0.5
  }
  inline_script = { # on_built & on_destroy behaviors
    script = cosmic_storms/PlanetaryShieldOnBuiltDestroy
  }

  resources = {
    category = planet_buildings
    cost = {
      minerals = @b2_minerals
      biomass = @b2_biomass
    }
    upkeep = {
      energy = @b2_upkeep
    }
  }

  inline_script = {
    script = buildings/on_all_wilderness_buildings_districts
  }

  custom_storm_ai_weight = {
    weight = 5
    modifier = {
      factor = 5
      AND = {
        exists = owner
        solar_system = {
          exists = owner
          owner = { num_cosmic_storms_encountered >=2 }
        }
      }
    }
  }

  ai_estimate_without_unemployment = yes
}
